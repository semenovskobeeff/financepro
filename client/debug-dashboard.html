<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Отладка дашборда</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .success {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .error {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        .loading {
            border-color: #007bff;
            background-color: #d1ecf1;
        }

        .log {
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 10px;
            overflow-x: auto;
        }

        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Отладка дашборда финансового приложения</h1>

        <div class="test-section">
            <h3>Быстрый тест API</h3>
            <button onclick="testDashboardAPI()">Тест API дашборда</button>
            <button onclick="testDebtsAPI()">Тест API долгов</button>
            <button onclick="testSubscriptionsAPI()">Тест API подписок</button>
            <button onclick="clearLogs()">Очистить логи</button>
        </div>

        <div id="results"></div>

        <div class="test-section">
            <h3>Инструкции по отладке</h3>
            <ol>
                <li>Сначала нажмите кнопки выше для тестирования API</li>
                <li>Откройте приложение: <a href="http://localhost:5175" target="_blank">http://localhost:5175</a></li>
                <li>Откройте консоль разработчика (F12)</li>
                <li>Проверьте сообщения MSW в консоли</li>
                <li>Посмотрите на вкладку Network для проверки запросов</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>Логи запросов</h3>
            <div id="logs" class="log"></div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        async function testAPI(url, name) {
            const resultDiv = document.getElementById('results');
            const testId = `test-${Date.now()}`;

            const testSection = document.createElement('div');
            testSection.className = 'test-section loading';
            testSection.id = testId;
            testSection.innerHTML = `<h4>Тестируем ${name}...</h4><p>Запрос: ${url}</p>`;
            resultDiv.appendChild(testSection);

            addLog(`Начинаем тест ${name}: ${url}`);

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (response.ok) {
                    testSection.className = 'test-section success';
                    testSection.innerHTML = `
                        <h4>✅ ${name} - Успешно</h4>
                        <p>Статус: ${response.status}</p>
                        <p>Данных получено: ${Array.isArray(data) ? data.length : 'объект'}</p>
                        <details>
                            <summary>Показать ответ</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;
                    addLog(`${name} - успешно: статус ${response.status}`, 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                testSection.className = 'test-section error';
                testSection.innerHTML = `
                    <h4>❌ ${name} - Ошибка</h4>
                    <p>Ошибка: ${error.message}</p>
                `;
                addLog(`${name} - ошибка: ${error.message}`, 'error');
            }
        }

        function testDashboardAPI() {
            testAPI('/api/analytics/dashboard', 'Аналитика дашборда');
        }

        function testDebtsAPI() {
            testAPI('/api/debts/upcoming?days=7', 'Предстоящие платежи по долгам');
        }

        function testSubscriptionsAPI() {
            testAPI('/api/subscriptions/upcoming?days=7', 'Предстоящие платежи по подпискам');
        }

        // Автозапуск тестов
        window.addEventListener('load', () => {
            addLog('Страница загружена. Можно запускать тесты.', 'info');
        });
    </script>
</body>

</html>
