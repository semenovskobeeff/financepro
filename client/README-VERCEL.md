# Развертывание на Vercel

## Подготовка к деплою

### 1. Настройка переменных окружения

В панели Vercel добавьте следующие переменные окружения:

**Обязательные:**

- `VITE_API_URL` - URL вашего API сервера (например: `https://your-api.herokuapp.com/api`)

**Необязательные:**

- `VITE_DEBUG` - включить режим отладки в production (`true`/`false`)
- `VITE_USE_MOCKS` - использовать моки по умолчанию (`true`/`false`)

### 2. Структура проекта

Убедитесь, что:

- Файл `vercel.json` настроен для SPA роутинга
- В `package.json` есть скрипт `build`
- Переменные окружения правильно типизированы в `vite-env.d.ts`

## Пошаговая инструкция

### Вариант 1: Через Vercel CLI

1. **Установите Vercel CLI:**

   ```bash
   npm i -g vercel
   ```

2. **Войдите в аккаунт:**

   ```bash
   vercel login
   ```

3. **Перейдите в папку client:**

   ```bash
   cd client
   ```

4. **Разверните проект:**

   ```bash
   vercel
   ```

5. **Настройте переменные окружения:**

   ```bash
   vercel env add VITE_API_URL
   # Введите URL вашего API
   ```

6. **Переразверните с новыми переменными:**
   ```bash
   vercel --prod
   ```

### Вариант 2: Через Vercel Dashboard

1. **Подключите GitHub репозиторий:**

   - Зайдите на [vercel.com](https://vercel.com)
   - Нажмите "New Project"
   - Выберите ваш репозиторий
   - Укажите корневую директорию: `client`

2. **Настройте билд:**

   - Build Command: `npm run build`
   - Output Directory: `dist`
   - Install Command: `npm ci`

3. **Добавьте переменные окружения:**

   - Перейдите в Settings → Environment Variables
   - Добавьте `VITE_API_URL` с URL вашего API

4. **Разверните:**
   - Нажмите "Deploy"

## Настройка домена

1. **Настройте API сервер:**

   - Убедитесь, что API поддерживает CORS для домена Vercel
   - Обновите настройки CORS на сервере

2. **Кастомный домен (опционально):**
   - В Settings → Domains добавьте свой домен
   - Настройте DNS записи согласно инструкциям Vercel

## Проверка деплоя

После развертывания проверьте:

- ✅ Приложение загружается
- ✅ Роутинг работает (обновление страницы не дает 404)
- ✅ API запросы идут на правильный URL
- ✅ Переключение темы работает
- ✅ localStorage сохраняется

## Troubleshooting

### Ошибка "Failed to load module"

- Убедитесь, что все импорты правильные
- Проверьте, что все dependencies установлены

### API запросы не работают

- Проверьте значение `VITE_API_URL`
- Убедитесь, что API сервер настроен на CORS
- Проверьте сетевую вкладку в DevTools

### Роутинг не работает (404 при обновлении)

- Убедитесь, что `vercel.json` настроен правильно
- Проверьте, что rewrites настроены для SPA

### Переменные окружения не работают

- Убедитесь, что имена начинаются с `VITE_`
- Переразверните проект после добавления переменных
- Проверьте типизацию в `vite-env.d.ts`

## Полезные команды

```bash
# Локальная сборка для тестирования
npm run build
npm run preview

# Проверка переменных окружения
vercel env ls

# Логи деплоя
vercel logs

# Откатить на предыдущую версию
vercel rollback
```

## Автоматизация

Для автоматического деплоя при push в main:

1. Подключите репозиторий к Vercel
2. Настройте Git Integration в настройках проекта
3. Каждый push в main будет автоматически разворачиваться
